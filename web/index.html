<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HULK Playground</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíö</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0e14;
            --surface: #131820;
            --surface-2: #1a2030;
            --surface-3: #212938;
            --border: #2a3444;
            --border-focus: #4ade80;
            --text: #e2e8f0;
            --text-2: #94a3b8;
            --text-3: #64748b;
            --green: #4ade80;
            --green-dim: #22c55e;
            --green-glow: rgba(74, 222, 128, 0.2);
            --red: #f87171;
            --yellow: #fbbf24;
            --purple: #a78bfa;
            --orange: #fb923c;
            --cyan: #67e8f9;
            --ui: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --mono: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'SF Mono', monospace;
            --header-h: 56px;
            --status-h: 32px;
            --radius: 8px;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--ui);
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        header {
            height: var(--header-h);
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            flex-shrink: 0;
            z-index: 10;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 18px;
            letter-spacing: -0.5px;
            user-select: none;
        }

        .logo-icon {
            width: 34px;
            height: 34px;
            background: linear-gradient(135deg, var(--green-dim), var(--green));
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 17px;
            font-weight: 800;
            color: #000;
            font-family: var(--mono);
            box-shadow: 0 0 16px var(--green-glow);
            transition: all 0.3s ease;
        }

        .logo-icon:hover {
            transform: rotate(-5deg) scale(1.05);
            box-shadow: 0 0 24px var(--green-glow);
        }

        .logo-text {
            background: linear-gradient(90deg, var(--green), #86efac);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .badges {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }

        .badge {
            background: var(--surface-2);
            color: var(--text-3);
            font-size: 10px;
            font-family: var(--mono);
            padding: 3px 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .badge.success {
            background: rgba(74, 222, 128, 0.15);
            color: var(--green);
            border-color: rgba(74, 222, 128, 0.3);
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #run-btn {
            background: linear-gradient(135deg, var(--green-dim), var(--green));
            color: #000;
            border: none;
            border-radius: var(--radius);
            padding: 8px 22px;
            font-family: var(--ui);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 7px;
            transition: all 0.2s;
            box-shadow: 0 0 20px var(--green-glow);
            position: relative;
            overflow: hidden;
        }
        #run-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        #run-btn:hover::before {
            left: 100%;
        }
        #run-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 30px rgba(74, 222, 128, 0.4);
        }
        #run-btn:active { transform: translateY(0); }
        #run-btn.loading { opacity: 0.7; pointer-events: none; }
        #run-btn .spinner {
            display: none;
            width: 14px; height: 14px;
            border: 2px solid rgba(0,0,0,0.2);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        #run-btn.loading .spinner { display: block; }
        #run-btn.loading .play-icon { display: none; }

        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .output-body {
            animation: fadeIn 0.3s ease;
        }

        .kbd {
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 2px 7px;
            font-size: 11px;
            font-family: var(--mono);
            color: var(--text-3);
            user-select: none;
        }

        /* ‚îÄ‚îÄ MAIN AREA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .left-sidebar {
            flex: 0 0 300px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: flex 0.3s ease;
        }

        .left-sidebar.expanded {
            flex: 1;
        }

        .sidebar-header {
            height: 36px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 14px;
            gap: 10px;
            flex-shrink: 0;
            position: relative;
        }

        .view-toggle {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--text-3);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-family: var(--mono);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-toggle:hover {
            background: var(--surface-2);
            color: var(--green);
        }

        .view-toggle.active {
            background: var(--green);
            color: #000;
            font-weight: 600;
        }

        .sidebar-header label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-2);
        }

        .sidebar-header select {
            flex: 1;
            background: var(--surface-2);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 10px;
            font-family: var(--ui);
            font-size: 12px;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
        }
        .sidebar-header select:hover { 
            border-color: var(--text-3);
            background: var(--surface-3);
        }
        .sidebar-header select:focus { 
            border-color: var(--green);
            box-shadow: 0 0 0 2px rgba(74, 222, 128, 0.15);
        }

        .docs-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            font-family: var(--ui);
            font-size: 13px;
            line-height: 1.65;
            color: var(--text-2);
            max-width: 100%;
            scroll-behavior: smooth;
        }

        .left-sidebar.expanded .docs-container {
            padding: 40px 64px 64px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .left-sidebar.expanded .docs-container h2 {
            font-size: 22px;
            margin-top: 48px;
            margin-bottom: 16px;
        }

        .left-sidebar.expanded .docs-container h2::before {
            height: 24px;
            width: 5px;
        }

        .left-sidebar.expanded .docs-container h3 {
            font-size: 16px;
            margin-top: 24px;
            margin-bottom: 10px;
        }

        .left-sidebar.expanded .docs-container {
            font-size: 14.5px;
            line-height: 1.75;
        }

        .left-sidebar.expanded .docs-container p {
            margin: 12px 0;
        }

        .left-sidebar.expanded .docs-container pre {
            font-size: 13.5px;
            padding: 16px 20px;
            margin: 12px 0 16px;
        }

        .left-sidebar.expanded .docs-container table {
            font-size: 13.5px;
        }

        .left-sidebar.expanded .docs-container .tip,
        .left-sidebar.expanded .docs-container .warning {
            padding: 14px 18px;
            margin: 16px 0;
            font-size: 14px;
        }

        .docs-container h2 {
            color: var(--green);
            font-size: 16px;
            font-weight: 700;
            margin: 24px 0 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
            letter-spacing: -0.4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .docs-container h2:first-child { margin-top: 0; }
        .docs-container h2::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--green);
            border-radius: 2px;
        }

        .docs-container h3 {
            color: var(--text);
            font-size: 13.5px;
            font-weight: 600;
            margin: 16px 0 6px;
        }

        .docs-container p {
            margin: 6px 0 10px;
        }

        .docs-container ul {
            margin: 6px 0 10px 18px;
        }

        .docs-container li {
            margin: 4px 0;
        }

        .docs-container code {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.2);
            border-radius: 4px;
            padding: 2px 7px;
            font-family: var(--mono);
            font-size: 12px;
            color: var(--green);
            font-weight: 500;
        }

        .docs-container pre {
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px;
            margin: 8px 0;
            overflow-x: auto;
            font-family: var(--mono);
            font-size: 11.5px;
            line-height: 1.5;
            color: var(--text);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .docs-container pre code {
            background: none;
            border: none;
            padding: 0;
            color: inherit;
        }

        .docs-container table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0 14px;
            font-size: 12px;
        }

        .docs-container th {
            text-align: left;
            padding: 7px 10px;
            background: var(--surface-2);
            border: 1px solid var(--border);
            color: var(--text);
            font-weight: 600;
            font-size: 12px;
        }

        .docs-container td {
            padding: 5px 10px;
            border: 1px solid var(--border);
        }

        .docs-container td code {
            font-size: 11px;
        }

        .docs-container .tip {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.08), rgba(74, 222, 128, 0.05));
            border-left: 4px solid var(--green);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 12px 0;
            font-size: 12.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .docs-container .tip strong { 
            color: var(--green);
            font-size: 13px;
        }

        .docs-container .warning {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(251, 191, 36, 0.05));
            border-left: 4px solid var(--yellow);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 12px 0;
            font-size: 12.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .docs-container .warning strong { 
            color: var(--yellow);
            font-size: 13px;
        }

        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 250px;
            transition: all 0.3s ease;
        }

        .editor-panel.hidden {
            display: none;
        }

        .output-panel.hidden {
            display: none;
        }

        .panel-label {
            height: 36px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 16px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-2);
            gap: 8px;
            flex-shrink: 0;
        }

        .panel-label .dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: var(--green);
        }

        #editor { flex: 1; }

        /* ‚îÄ‚îÄ OUTPUT PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .output-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 250px;
        }

        .output-tabs {
            height: 36px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 8px;
            gap: 2px;
            flex-shrink: 0;
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: var(--text-3);
            font-family: var(--ui);
            font-size: 12px;
            font-weight: 500;
            padding: 6px 14px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.15s;
        }
        .tab-btn:hover { color: var(--text-2); background: var(--surface-2); }
        .tab-btn.active { color: var(--text); background: var(--surface-2); }
        .tab-btn .icon { font-size: 11px; opacity: 0.8; }

        .output-body {
            flex: 1;
            overflow: auto;
            padding: 16px;
            font-family: var(--mono);
            font-size: 13px;
            line-height: 1.7;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .output-body.hidden { display: none; }

        /* Output states */
        .out-ok { color: var(--green); }
        .out-err { color: var(--red); }

        .welcome-msg {
            color: var(--text-3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            gap: 10px;
            font-family: var(--ui);
            font-size: 14px;
        }
        .welcome-msg .big-icon { font-size: 56px; opacity: 0.25; }
        .welcome-msg strong { color: var(--text-2); }

        #llvm-body {
            color: var(--text-3);
            font-size: 11px;
            line-height: 1.4;
        }

        /* ‚îÄ‚îÄ STATUS BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .status-bar {
            height: var(--status-h);
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            font-size: 11.5px;
            color: var(--text-3);
            flex-shrink: 0;
        }

        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 7px; height: 7px;
            border-radius: 50%;
            background: var(--green);
            transition: background 0.2s;
        }
        .status-dot.err { background: var(--red); }
        .status-dot.busy {
            background: var(--yellow);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        #docs-body .tip strong { color: var(--green); }

        /* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--surface-3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--border); }
    </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<header>
    <div class="logo">
        <div class="logo-icon">H</div>
        <span class="logo-text">HULK Playground</span>
        <div class="badges">
            <span class="badge">v1.0.0</span>
            <span class="badge success">‚úì 169 tests</span>
        </div>
    </div>
    <div class="controls">
        <button id="run-btn">
            <span class="play-icon">‚ñ∂</span>
            <span class="spinner"></span>
            Ejecutar
        </button>
        <span class="kbd">‚åò‚Üµ</span>
    </div>
</header>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<main>
    <!-- LEFT SIDEBAR: Examples + Documentation -->
    <div class="left-sidebar" id="sidebar">
        <div class="sidebar-header">
            <label>üìù Ejemplos</label>
            <select id="examples">
                <option value="">Selecciona‚Ä¶</option>
                <option value="hello">üü¢ Hello World</option>
                <option value="math">üî¢ Variables y Matem√°ticas</option>
                <option value="functions">‚ö° Funciones Recursivas</option>
                <option value="strings">üìù Cadenas</option>
                <option value="conditionals">üîÄ Condicionales</option>
                <option value="loops">üîÑ Ciclos</option>
                <option value="types">üèóÔ∏è Tipos y Herencia</option>
                <option value="iterables">üì¶ Iterables y For</option>
                <option value="demo">üéØ Demo Completo</option>
            </select>
            <button class="view-toggle" id="view-toggle" title="Ver documentaci√≥n completa">
                <span class="icon">üìñ</span>
                <span class="label">Docs</span>
            </button>
        </div>
        
        <div class="docs-container">
            <h2>HULK Language Reference</h2>
            <p><strong>H</strong>avana <strong>U</strong>niversity <strong>L</strong>anguage for <strong>K</strong>ompilers</p>
            <p>HULK es un lenguaje de programaci√≥n fuertemente tipado con inferencia de tipos, sem√°ntica de expresiones, programaci√≥n funcional, y programaci√≥n orientada a objetos con herencia y protocolos. El lenguaje compila directamente a LLVM IR para generaci√≥n eficiente de c√≥digo nativo.</p>

            <div class="warning">
                <strong>Documentaci√≥n Oficial Completa:</strong><br>
                Para la especificaci√≥n completa del lenguaje, visite:<br>
                <a href="https://matcom.github.io/hulk/guide/intro.html" target="_blank" style="color: #4ade80; text-decoration: underline;">https://matcom.github.io/hulk/guide/intro.html</a>
            </div>

            <div class="tip">
                <strong>Arquitectura del Programa</strong><br>
                Todo programa HULK se divide en dos secciones fundamentales:<br>
                1. <b>Declaraciones Top-Level</b>: Definiciones de <code>function</code>, <code>type</code> y <code>protocol</code> que son visibles globalmente<br>
                2. <b>Expresi√≥n de Ejecuci√≥n</b>: C√≥digo principal entre llaves <code>{ }</code> que se eval√∫a al ejecutar el programa<br><br>
                Las declaraciones se procesan primero y est√°n disponibles en toda la expresi√≥n principal. No es necesario declarar antes de usar.
            </div>

            <h3>Ejemplo de Estructura Completa</h3>
            <pre><code>// Secci√≥n de declaraciones (scope global)
function fibonacci(n) => 
    if (n <= 1) n
    else fibonacci(n-1) + fibonacci(n-2);

type Punto(x: Number, y: Number) {
    x = x;
    y = y;
    distancia() => sqrt(x**2 + y**2);
}

// Expresi√≥n principal (c√≥digo a ejecutar)
{
    print("Fibonacci de 10:");
    print(fibonacci(10));
    
    let p = new Punto(3, 4) in
        print("Distancia al origen: " @@ p.distancia());
}</code></pre>

            <h2>Sistema de Variables y Let-In</h2>
            
            <h3>Inmutabilidad por Defecto</h3>
            <p>HULK adopta inmutabilidad por defecto para prevenir efectos secundarios no deseados. Las variables declaradas con <code>let...in</code> son constantes dentro de su scope:</p>
            <pre><code>let x = 10, y = 20 in
    print(x + y); // 30

// Scope anidado
let pi = 3.14159 in
let radio = 5 in
let area = pi * radio ** 2 in
    print("Area del c√≠rculo: " @@ area);</code></pre>

            <h3>Variables Mutables con Asignaci√≥n Destructiva</h3>
            <p>Cuando se requiere mutabilidad, se declara usando el operador <code>:=</code> en lugar de <code>=</code>. Posteriormente, la variable puede ser reasignada usando tambi√©n <code>:=</code>:</p>
            <pre><code>let contador := 0 in {
    print(contador);       // 0
    contador := contador + 1;
    print(contador);       // 1
    contador := contador * 10;
    print(contador);       // 10
}</code></pre>

            <h3>Alcance y Shadowing</h3>
            <p>Las variables tienen alcance l√©xico. Las declaraciones internas pueden hacer shadow de las externas:</p>
            <pre><code>let x = 10 in {
    print(x);           // 10
    let x = 20 in {
        print(x);       // 20 (shadow)
    };
    print(x);           // 10 (restaurado)
}</code></pre>

            <div class="tip">
                <strong>Restricciones de Mutabilidad:</strong> Solo pueden ser mutables:<br>
                ‚Ä¢ Variables declaradas con <code>let := </code><br>
                ‚Ä¢ Atributos de tipos declarados con <code>=</code> seguido de <code>:=</code> para reasignaci√≥n<br>
                Los par√°metros de funci√≥n son siempre inmutables por dise√±o.
            </div>

            <h2>Funciones como Ciudadanos de Primera Clase</h2>
            
            <h3>Declaraci√≥n y Tipos</h3>
            <p>Las funciones en HULK son expresiones de primera clase. Pueden ser pasadas como argumentos, retornadas desde otras funciones, y almacenadas en variables. Soportan inferencia de tipos o declaraci√≥n expl√≠cita:</p>
            <pre><code>// Sintaxis inline simple
function suma(a, b) => a + b;

// Con anotaciones de tipo
function potencia(base: Number, exp: Number): Number =>
    if (exp == 0) 1
    else base * potencia(base, exp - 1);

// Funci√≥n con cuerpo de bloque
function estadisticas(valores) => {
    let suma = calcularSuma(valores) in
    let promedio = suma / longitud(valores) in
    let varianza = calcularVarianza(valores, promedio) in
        new Estadisticas(promedio, varianza);
};</code></pre>

            <h3>Recursi√≥n y Tail-Call</h3>
            <p>HULK soporta recursi√≥n completa. Para funciones recursivas cr√≠ticas, considere reescribir en forma tail-recursive cuando sea posible:</p>
            <pre><code>// Recursi√≥n est√°ndar (puede causar stack overflow)
function factorial(n) =>
    if (n <= 1) 1
    else n * factorial(n - 1);

// Tail recursion con acumulador (optimizable)
function factorial_tail(n, acc) =>
    if (n <= 1) acc
    else factorial_tail(n - 1, n * acc);

function factorial(n) => factorial_tail(n, 1);</code></pre>

            <h3>Funciones de Orden Superior</h3>
            <p>Las funciones pueden aceptar otras funciones como par√°metros y retornar nuevas funciones, permitiendo abstracciones poderosas:</p>
            <pre><code>// Funci√≥n que aplica una funci√≥n a un valor
function aplicar(f, x) => f(x);

// Funciones que pueden ser pasadas
function cuadrado(x) => x * x;
function cubo(x) => x * x * x;
function duplicar(x) => x * 2;
function incrementar(x) => x + 1;

{
    print(aplicar(cuadrado, 5));     // 25
    print(aplicar(cubo, 3));         // 27
    print(aplicar(duplicar, 8));     // 16
}

// Composici√≥n de funciones: (f ‚àò g)(x) = f(g(x))
function componer(f, g) =>
    function(x) => f(g(x));

{
    let f = componer(cuadrado, incrementar) in
        print(f(4));  // (4+1)^2 = 25
        
    let g = componer(incrementar, cuadrado) in
        print(g(4));  // (4^2)+1 = 17
}</code></pre>

            <h3>Currying y Aplicaci√≥n Parcial</h3>
            <pre><code>// Funci√≥n que retorna otra funci√≥n
function multiplicador(factor) =>
    function(x) => x * factor;

{
    let duplicar = multiplicador(2) in
    let triplicar = multiplicador(3) in {
        print(duplicar(5));   // 10
        print(triplicar(5));  // 15
    };
}

// Currying manual
function suma_currificada(a) =>
    function(b) =>
        function(c) => a + b + c;

{
    print(suma_currificada(1)(2)(3)); // 6
}</code></pre>

            <h3>Closures y Captura de Entorno</h3>
            <p>Las funciones capturan el entorno l√©xico donde fueron definidas, permitiendo implementar estado encapsulado:</p>
            <pre><code>// Generador de contadores con estado privado
function crearContador(inicial) => {
    let valor := inicial in
    new Contador(
        function() => {
            valor := valor + 1;
            valor
        },
        function() => valor,
        function() => { valor := inicial; }
    );
};

type Contador(inc, get, reset) {
    incrementar = inc;
    obtener = get;
    resetear = reset;
}

{
    let c1 = crearContador(0) in
    let c2 = crearContador(100) in {
        print(c1.incrementar()); // 1
        print(c1.incrementar()); // 2
        print(c2.incrementar()); // 101
        print(c1.obtener());     // 2
        c1.resetear();
        print(c1.obtener());     // 0
    };
}</code></pre>

            <h2>Estructuras de Control</h2>
            
            <h3>Expresiones Condicionales</h3>
            <p>En HULK, <code>if</code> no es una sentencia sino una expresi√≥n que retorna un valor. Todas las ramas deben tener el mismo tipo de retorno:</p>
            <pre><code>// Condicional simple
let signo = if (x > 0) "positivo"
            elif (x < 0) "negativo"
            else "cero";

// Condicionales anidados
let categoria = 
    if (edad < 2) "beb√©"
    elif (edad < 13) "ni√±o"
    elif (edad < 18) "adolescente"
    elif (edad < 65) "adulto"
    else "adulto mayor";

// Asignaci√≥n condicional compleja
let descuento = 
    if (esEstudiante & esLunes) 0.30
    elif (esEstudiante) 0.15
    elif (esMayorDe60) 0.20
    else 0.0;</code></pre>

            <div class="warning">
                <strong>Restricci√≥n de Tipos:</strong> El sistema de tipos garantiza que todas las ramas de un condicional retornen el mismo tipo. Intentar retornar tipos incompatibles (ej: Number en una rama y String en otra) resultar√° en un error de compilaci√≥n.
            </div>

            <h3>Operadores L√≥gicos con Cortocircuito</h3>
            <p>Los operadores l√≥gicos implementan evaluaci√≥n de cortocircuito (short-circuit evaluation) para eficiencia:</p>
            <table>
                <tr><th>Operador</th><th>Descripci√≥n</th><th>Comportamiento</th><th>Ejemplo</th></tr>
                <tr><td><code>&</code></td><td>AND l√≥gico</td><td>Si el primer operando es falso, no eval√∫a el segundo</td><td><code>x != 0 & y/x > 1</code></td></tr>
                <tr><td><code>|</code></td><td>OR l√≥gico</td><td>Si el primer operando es verdadero, no eval√∫a el segundo</td><td><code>x == 0 | y == 0</code></td></tr>
                <tr><td><code>!</code></td><td>NOT l√≥gico</td><td>Niega el valor booleano</td><td><code>!esPrimo(n)</code></td></tr>
            </table>

            <pre><code>// Uso del cortocircuito para evitar errores
function division_segura(a, b) =>
    if (b != 0 & a/b > 10) "grande"
    elif (b != 0 & a/b > 0) "positivo"
    else "otro";

// Expresiones complejas
let valido = 
    (edad >= 18 & edad <= 65) & 
    (tieneDocumento | esExtranjero) &
    !estaBloqueado;</code></pre>

            <h2>Iteraci√≥n y Ciclos</h2>
            
            <h3>While Loop</h3>
            <p>El ciclo <code>while</code> ejecuta mientras la condici√≥n sea verdadera. Requiere variables mutables para el control:</p>
            <pre><code>// Suma de n√∫meros del 1 al n
function sumaHastaN(n) => {
    let suma := 0 in
    let i := 1 in {
        while (i <= n) {
            suma := suma + i;
            i := i + 1;
        };
        suma
    };
};

// B√∫squeda secuencial
function buscar(arr, target) => {
    let i := 0 in
    let encontrado := false in {
        while (i < arr.length() & !encontrado) {
            if (arr.get(i) == target)
                encontrado := true
            else
                i := i + 1;
        };
        if (encontrado) i else -1
    };
};</code></pre>

            <h3>For Loop con Protocolo Iterable</h3>
            <p>El ciclo <code>for...in</code> opera sobre cualquier objeto que implemente el protocolo de iteraci√≥n, el cual requiere dos m√©todos:</p>
            <ul>
                <li><code>next(): Boolean</code> - Avanza el iterador y retorna <code>true</code> si hay m√°s elementos</li>
                <li><code>get_current()</code> - Retorna el elemento actual sin avanzar</li>
            </ul>

            <pre><code>// Implementaci√≥n de Range iterable
type Range(inicio, fin, paso) {
    inicio = inicio;
    fin = fin;
    paso = paso;
    actual := inicio;
    
    next() => {
        let temp = actual in {
            actual := actual + paso;
            temp < fin
        };
    };
    
    get_current() => actual;
}

// Constructor auxiliar con paso por defecto
function range(inicio, fin) =>
    new Range(inicio, fin, 1);

{
    // Iteraci√≥n b√°sica
    for (i in range(0, 10))
        print(i);
    
    // Con paso personalizado
    for (x in new Range(0, 100, 10))
        print(x); // 0, 10, 20, ..., 90
}

// Lista enlazada iterable
type Nodo(valor, siguiente) {
    valor = valor;
    siguiente = siguiente;
    actual := self;
    
    next() => {
        if (actual == null) false
        else {
            let sig = actual.siguiente in {
                actual := sig;
                sig != null
            };
        };
    };
    
    get_current() => 
        if (actual != null) actual.valor 
        else null;
}</code></pre>

            <h2>Programaci√≥n Orientada a Objetos</h2>
            
            <h3>Definici√≥n de Tipos</h3>
            <p>Los tipos en HULK encapsulan datos y comportamiento. La sintaxis del constructor especifica par√°metros que pueden inicializar atributos:</p>
            <pre><code>type Persona(nombre: String, edad: Number, email: String) {
    // Atributos inmutables
    nombre = nombre;
    email = email;
    
    // Atributo mutable
    edad := edad;
    
    // M√©todos de instancia
    saludar() => 
        print("Hola, mi nombre es " @@ nombre);
    
    cumplirAnios() => {
        edad := edad + 1;
        print(nombre @@ " ahora tiene " @@ edad @@ " a√±os");
    };
    
    cambiarEmail(nuevoEmail) =>
        new Persona(nombre, edad, nuevoEmail);
    
    info(): String =>
        nombre @@ " (" @@ edad @@ " a√±os) - " @@ email;
}</code></pre>

            <h3>Herencia y Polimorfismo</h3>
            <p>HULK soporta herencia simple con la palabra clave <code>inherits</code>. Los tipos derivados heredan atributos y m√©todos, y pueden sobrescribirlos:</p>
            <pre><code>type Animal(nombre: String, especie: String) {
    nombre = nombre;
    especie = especie;
    energia := 100;
    
    hacer_sonido(): String => "...";
    
    comer() => {
        energia := energia + 20;
        print(nombre @@ " ha comido. Energ√≠a: " @@ energia);
    };
    
    moverse() => {
        energia := energia - 10;
        print(nombre @@ " se ha movido. Energ√≠a: " @@ energia);
    };
    
    info() => nombre @@ " es un " @@ especie;
}

type Perro(nombre: String, raza: String) 
    inherits Animal(nombre, "Canis familiaris") {
    
    raza = raza;
    
    // Override del m√©todo hacer_sonido
    hacer_sonido() => "¬°Guau guau!";
    
    // M√©todo espec√≠fico de Perro
    mover_cola() => 
        print(nombre @@ " mueve la cola alegremente");
    
    // Override con llamada a base
    info() => base() @@ " de raza " @@ raza;
}

type Gato(nombre: String, color: String) 
    inherits Animal(nombre, "Felis catus") {
    
    color = color;
    
    hacer_sonido() => "¬°Miau!";
    
    ronronear() =>
        print(nombre @@ " ronronea suavemente");
    
    info() => base() @@ " de color " @@ color;
}</code></pre>

            <h3>M√©todo base() para Llamadas al Padre</h3>
            <p>El m√©todo especial <code>base()</code> permite invocar la implementaci√≥n de un m√©todo en la clase padre:</p>
            <pre><code>type Vehiculo(marca: String) {
    marca = marca;
    velocidad := 0;
    
    acelerar() => {
        velocidad := velocidad + 10;
        print("Acelerando...");
    };
    
    descripcion() => "Veh√≠culo marca " @@ marca;
}

type Automovil(marca: String, modelo: String, anio: Number) 
    inherits Vehiculo(marca) {
    
    modelo = modelo;
    anio = anio;
    
    // Override que extiende funcionalidad
    acelerar() => {
        base();  // Llama a Vehiculo.acelerar()
        if (velocidad > 100)
            print("¬°Precauci√≥n! Alta velocidad");
    };
    
    // Override que extiende descripci√≥n
    descripcion() =>
        base() @@ ", modelo " @@ modelo @@ " (" @@ anio @@ ")";
}</code></pre>

            <h3>Type Checking y Casting</h3>
            <p>Los operadores <code>is</code> y <code>as</code> permiten verificaci√≥n de tipos en tiempo de ejecuci√≥n y conversi√≥n segura:</p>
            <pre><code>function procesar_animal(animal: Animal) => {
    print("Procesando: " @@ animal.info());
    print("Sonido: " @@ animal.hacer_sonido());
    
    // Type checking con is
    if (animal is Perro) {
        // Safe cast con as
        let perro = animal as Perro in {
            print("Es un perro de raza " @@ perro.raza);
            perro.mover_cola();
        };
    };
    
    if (animal is Gato) {
        let gato = animal as Gato in {
            print("Es un gato de color " @@ gato.color);
            gato.ronronear();
        };
    };
};

{
    let max = new Perro("Max", "Golden Retriever") in
    let luna = new Gato("Luna", "Negro") in {
        procesar_animal(max);
        procesar_animal(luna);
    };
}</code></pre>

            <h2>Protocolos e Interfaces</h2>
            <p>Los protocolos definen contratos que los tipos deben cumplir, permitiendo polimorfismo sin herencia:</p>
            <pre><code>protocol Comparable {
    comparar(otro): Number;  // < 0 si menor, 0 si igual, > 0 si mayor
}

protocol Serializable {
    serializar(): String;
    deserializar(datos: String);
}

protocol Drawable {
    dibujar(): String;
    area(): Number;
    perimetro(): Number;
}

// Tipo que implementa m√∫ltiples protocolos
type Circulo(radio: Number) 
    extends Drawable, Comparable {
    
    radio = radio;
    
    // Implementaci√≥n de Drawable
    dibujar() => "C√≠rculo de radio " @@ radio;
    area() => 3.14159265359 * radio ** 2;
    perimetro() => 2 * 3.14159265359 * radio;
    
    // Implementaci√≥n de Comparable
    comparar(otro) =>
        if (otro is Circulo) {
            let otroCirculo = otro as Circulo in
                area() - otroCirculo.area();
        } else 0;
}

type Rectangulo(base: Number, altura: Number)
    extends Drawable, Comparable {
    
    base = base;
    altura = altura;
    
    dibujar() => "Rect√°ngulo " @@ base @@ "x" @@ altura;
    area() => base * altura;
    perimetro() => 2 * (base + altura);
    
    comparar(otro) =>
        if (otro is Rectangulo) {
            let otroRect = otro as Rectangulo in
                area() - otroRect.area();
        } else 0;
}

// Funci√≥n gen√©rica que opera sobre cualquier Drawable
function describir_figura(fig: Drawable) => {
    print(fig.dibujar());
    print("√Årea: " @@ fig.area());
    print("Per√≠metro: " @@ fig.perimetro());
};</code></pre>

            <h2>Sistema de Operadores</h2>
            
            <h3>Operadores Aritm√©ticos</h3>
            <table>
                <tr><th>Operador</th><th>Descripci√≥n</th><th>Precedencia</th><th>Ejemplo</th><th>Resultado</th></tr>
                <tr><td><code>**</code></td><td>Potenciaci√≥n</td><td>M√°s alta</td><td><code>2 ** 3 ** 2</code></td><td>512 (asociatividad derecha)</td></tr>
                <tr><td><code>*</code></td><td>Multiplicaci√≥n</td><td>Alta</td><td><code>3 * 4</code></td><td>12</td></tr>
                <tr><td><code>/</code></td><td>Divisi√≥n (real)</td><td>Alta</td><td><code>7 / 2</code></td><td>3.5</td></tr>
                <tr><td><code>%</code></td><td>M√≥dulo</td><td>Alta</td><td><code>17 % 5</code></td><td>2</td></tr>
                <tr><td><code>+</code></td><td>Suma</td><td>Media</td><td><code>10 + 5</code></td><td>15</td></tr>
                <tr><td><code>-</code></td><td>Resta</td><td>Media</td><td><code>10 - 3</code></td><td>7</td></tr>
            </table>

            <h3>Operadores de String</h3>
            <table>
                <tr><th>Operador</th><th>Descripci√≥n</th><th>Ejemplo</th><th>Resultado</th></tr>
                <tr><td><code>@@</code></td><td>Concatenaci√≥n directa sin separaci√≥n</td><td><code>"Hola" @@ "Mundo"</code></td><td>"HolaMundo"</td></tr>
                <tr><td><code>@</code></td><td>Concatenaci√≥n con espacio autom√°tico</td><td><code>"Hola" @ "Mundo"</code></td><td>"Hola Mundo"</td></tr>
            </table>

            <p>Conversi√≥n autom√°tica a string: Todos los tipos tienen una representaci√≥n en string impl√≠cita.</p>
            <pre><code>let x = 42, y = 3.14 in {
    print("El n√∫mero es " @@ x);           // "El n√∫mero es 42"
    print("Pi vale aproximadamente" @ y);  // "Pi vale aproximadamente 3.14"
}</code></pre>

            <h3>Operadores de Comparaci√≥n</h3>
            <table>
                <tr><th>Operador</th><th>Descripci√≥n</th><th>Tipos Soportados</th><th>Retorna</th></tr>
                <tr><td><code>==</code></td><td>Igualdad por valor</td><td>Number, String, Boolean</td><td>Boolean</td></tr>
                <tr><td><code>!=</code></td><td>Desigualdad</td><td>Number, String, Boolean</td><td>Boolean</td></tr>
                <tr><td><code>&lt;</code></td><td>Menor que</td><td>Number, String (lexicogr√°fico)</td><td>Boolean</td></tr>
                <tr><td><code>&gt;</code></td><td>Mayor que</td><td>Number, String (lexicogr√°fico)</td><td>Boolean</td></tr>
                <tr><td><code>&lt;=</code></td><td>Menor o igual</td><td>Number, String</td><td>Boolean</td></tr>
                <tr><td><code>&gt;=</code></td><td>Mayor o igual</td><td>Number, String</td><td>Boolean</td></tr>
            </table>

            <h3>Precedencia y Asociatividad</h3>
            <pre><code>// Precedencia de operadores (de mayor a menor)
2 + 3 * 4       // 14 (no 20)
2 ** 3 ** 2     // 512 (** es asociativo a derecha: 2**(3**2))
10 - 5 - 2      // 3 (-, +, *, / son asociativos a izquierda)
x > 5 & y < 10  // primero comparaciones, luego AND l√≥gico</code></pre>

            <h2>Biblioteca Est√°ndar Built-in</h2>
            
            <h3>Funciones Matem√°ticas</h3>
            <table>
                <tr><th>Funci√≥n</th><th>Descripci√≥n</th><th>Dominio</th><th>Ejemplo</th><th>Resultado</th></tr>
                <tr><td><code>sqrt(x)</code></td><td>Ra√≠z cuadrada</td><td>x ‚â• 0</td><td><code>sqrt(16)</code></td><td>4.0</td></tr>
                <tr><td><code>sin(x)</code></td><td>Seno (radianes)</td><td>‚Ñù</td><td><code>sin(3.14159/2)</code></td><td>~1.0</td></tr>
                <tr><td><code>cos(x)</code></td><td>Coseno (radianes)</td><td>‚Ñù</td><td><code>cos(0)</code></td><td>1.0</td></tr>
                <tr><td><code>exp(x)</code></td><td>Exponencial (e^x)</td><td>‚Ñù</td><td><code>exp(1)</code></td><td>2.71828...</td></tr>
                <tr><td><code>log(x)</code></td><td>Logaritmo natural</td><td>x > 0</td><td><code>log(2.71828)</code></td><td>~1.0</td></tr>
                <tr><td><code>rand()</code></td><td>N√∫mero aleatorio</td><td>[0, 1)</td><td><code>rand()</code></td><td>0.73584...</td></tr>
            </table>

            <h3>Entrada/Salida</h3>
            <table>
                <tr><th>Funci√≥n</th><th>Descripci√≥n</th><th>Uso</th></tr>
                <tr><td><code>print(x)</code></td><td>Imprime valor en stdout con newline</td><td><code>print("Hello, World!")</code></td></tr>
            </table>

            <h2>Patrones de Dise√±o Comunes</h2>

            <h3>Map y Filter Funcional</h3>
            <p>Implementaci√≥n de operaciones funcionales sobre estructuras de datos:</p>
            <pre><code>// Definici√≥n de lista enlazada
type Lista(valor, siguiente) {
    valor = valor;
    siguiente = siguiente;
    
    vacia() => false;
}

type ListaVacia() {
    vacia() => true;
}

// Map: aplica funci√≥n a cada elemento
function map(f, lista) =>
    if (lista.vacia()) new ListaVacia()
    else new Lista(
        f(lista.valor),
        map(f, lista.siguiente)
    );

// Filter: retiene elementos que cumplen predicado
function filter(pred, lista) =>
    if (lista.vacia()) new ListaVacia()
    elif (pred(lista.valor))
        new Lista(lista.valor, filter(pred, lista.siguiente))
    else filter(pred, lista.siguiente);

// Fold (reduce): acumula valores
function fold(f, acc, lista) =>
    if (lista.vacia()) acc
    else fold(f, f(acc, lista.valor), lista.siguiente);

// Ejemplo de uso
{
    let nums = new Lista(1, new Lista(2, new Lista(3, new ListaVacia()))) in
    let cuadrados = map(function(x) => x * x, nums) in
    let pares = filter(function(x) => x % 2 == 0, nums) in
    let suma = fold(function(a, b) => a + b, 0, nums) in {
        // cuadrados: [1, 4, 9]
        // pares: [2]
        // suma: 6
    };
}</code></pre>

            <h3>Pattern Matching Simulado</h3>
            <p>Implementaci√≥n de pattern matching estilo ML/Haskell usando type checking:</p>
            <pre><code>// AST para expresiones aritm√©ticas
type Numero(valor) { valor = valor; }
type Suma(izq, der) { izq = izq; der = der; }
type Resta(izq, der) { izq = izq; der = der; }
type Mult(izq, der) { izq = izq; der = der; }
type Div(izq, der) { izq = izq; der = der; }

// Evaluador recursivo con pattern matching
function evaluar(expr) =>
    if (expr is Numero) 
        (expr as Numero).valor
    elif (expr is Suma) {
        let e = expr as Suma in
            evaluar(e.izq) + evaluar(e.der);
    }
    elif (expr is Resta) {
        let e = expr as Resta in
            evaluar(e.izq) - evaluar(e.der);
    }
    elif (expr is Mult) {
        let e = expr as Mult in
            evaluar(e.izq) * evaluar(e.der);
    }
    elif (expr is Div) {
        let e = expr as Div in
            evaluar(e.izq) / evaluar(e.der);
    }
    else 0;

// Ejemplo: (3 + 5) * (10 - 2)
{
    let expr = new Mult(
        new Suma(new Numero(3), new Numero(5)),
        new Resta(new Numero(10), new Numero(2))
    ) in
        print(evaluar(expr)); // 64
}</code></pre>

            <h3>Builder Pattern para Configuraci√≥n</h3>
            <pre><code>// Builder para construcci√≥n fluida de objetos
type ConfigBuilder() {
    host := "localhost";
    port := 8080;
    timeout := 30;
    debug := false;
    logLevel := "INFO";
    
    setHost(h) => { host := h; self; };
    setPort(p) => { port := p; self; };
    setTimeout(t) => { timeout := t; self; };
    enableDebug() => { debug := true; self; };
    setLogLevel(level) => { logLevel := level; self; };
    
    build() => new Config(host, port, timeout, debug, logLevel);
}

type Config(host, port, timeout, debug, logLevel) {
    host = host;
    port = port;
    timeout = timeout;
    debug = debug;
    logLevel = logLevel;
    
    toString() =>
        "Config{host=" @@ host @@ 
        ", port=" @@ port @@ 
        ", timeout=" @@ timeout @@ 
        ", debug=" @@ debug @@ 
        ", logLevel=" @@ logLevel @@ "}";
}

// Uso
{
    let config = new ConfigBuilder()
        .setHost("api.example.com")
        .setPort(443)
        .setTimeout(60)
        .enableDebug()
        .setLogLevel("DEBUG")
        .build() in
        print(config.toString());
}</code></pre>

            <h3>Visitor Pattern para Recorrido de √Årboles</h3>
            <pre><code>protocol Visitor {
    visitNumero(n);
    visitOperacion(op);
}

type PrintVisitor() extends Visitor {
    visitNumero(n) => print("N√∫mero: " @@ n.valor);
    visitOperacion(op) => {
        print("Operaci√≥n: " @@ op.operador);
        op.izquierdo.accept(self);
        op.derecho.accept(self);
    };
}</code></pre>

            <h2>Optimizaciones del Compilador</h2>
            <p>El compilador HULK implementa un pipeline de optimizaci√≥n multinivel:</p>

            <h3>Optimizaciones en AST (Pre-LLVM)</h3>
            <ul>
                <li><strong>Constant Folding:</strong> Evaluaci√≥n de expresiones constantes en tiempo de compilaci√≥n
                    <pre><code>2 + 3 * 4  ‚Üí  14
"Hello" @@ " " @@ "World"  ‚Üí  "Hello World"</code></pre>
                </li>
                <li><strong>Constant Propagation:</strong> Propagaci√≥n de valores constantes conocidos
                    <pre><code>let x = 10 in x * 2  ‚Üí  20</code></pre>
                </li>
                <li><strong>Dead Code Elimination:</strong> Eliminaci√≥n de c√≥digo inalcanzable
                    <pre><code>if (true) A else B  ‚Üí  A
if (false) A else B  ‚Üí  B</code></pre>
                </li>
                <li><strong>Algebraic Simplification:</strong> Simplificaciones algebraicas
                    <pre><code>x * 1  ‚Üí  x
x + 0  ‚Üí  x
x * 0  ‚Üí  0
x ** 1  ‚Üí  x</code></pre>
                </li>
                <li><strong>Boolean Short-Circuit:</strong> Optimizaci√≥n de expresiones booleanas
                    <pre><code>false & expr  ‚Üí  false
true | expr   ‚Üí  true</code></pre>
                </li>
                <li><strong>String Interning:</strong> Reutilizaci√≥n de literales de string id√©nticos</li>
            </ul>

            <h3>Optimizaciones LLVM</h3>
            <p>Despu√©s de generar LLVM IR, se aplican optimizaciones adicionales:</p>
            <ul>
                <li>Inlining de funciones peque√±as</li>
                <li>Loop unrolling y vectorizaci√≥n</li>
                <li>Register allocation optimizado</li>
                <li>Dead store elimination</li>
                <li>Common subexpression elimination (CSE)</li>
                <li>Tail call optimization</li>
            </ul>

            <h2>Compilaci√≥n a LLVM IR</h2>
            <p>HULK utiliza LLVM (Low Level Virtual Machine) como backend de compilaci√≥n, proporcionando:</p>

            <h3>Ventajas de LLVM</h3>
            <ul>
                <li><strong>Portabilidad:</strong> Generaci√≥n de c√≥digo nativo para x86, x86-64, ARM, WebAssembly, etc.</li>
                <li><strong>Optimizaciones Avanzadas:</strong> D√©cadas de investigaci√≥n en optimizaci√≥n de compiladores</li>
                <li><strong>Interoperabilidad:</strong> Compatibilidad ABI con C/C++ para integraci√≥n con bibliotecas existentes</li>
                <li><strong>Performance:</strong> C√≥digo generado comparable a C/C++ en la mayor√≠a de casos</li>
                <li><strong>Tooling:</strong> Acceso a herramientas LLVM (llvm-dis, opt, llc, etc.)</li>
            </ul>

            <h3>Pipeline de Compilaci√≥n</h3>
            <ol>
                <li><strong>Parsing:</strong> C√≥digo HULK ‚Üí AST (Abstract Syntax Tree)</li>
                <li><strong>Macro Expansion:</strong> Expansi√≥n de macros si existen</li>
                <li><strong>Semantic Analysis:</strong> Type checking, scope resolution, validaci√≥n de protocolos</li>
                <li><strong>Optimization Pass:</strong> Optimizaciones a nivel AST</li>
                <li><strong>LLVM IR Generation:</strong> AST optimizado ‚Üí LLVM IR textual</li>
                <li><strong>LLVM Optimization:</strong> Optimizaciones a nivel LLVM (opcional)</li>
                <li><strong>Code Generation:</strong> LLVM IR ‚Üí c√≥digo m√°quina nativo v√≠a Clang</li>
            </ol>

            <h3>Inspecci√≥n de LLVM IR</h3>
            <p>Este playground permite inspeccionar el c√≥digo LLVM IR generado mediante el tab "LLVM IR". El IR muestra:</p>
            <ul>
                <li>Declaraciones de funciones y tipos</li>
                <li>Instrucciones SSA (Static Single Assignment)</li>
                <li>Bloques b√°sicos y control flow</li>
                <li>Llamadas a funciones built-in (printf, sqrt, sin, etc.)</li>
            </ul>

            <div class="tip">
                <strong>Ejecuci√≥n R√°pida:</strong> Use Command+Enter (macOS) o Ctrl+Enter (Windows/Linux) para compilar y ejecutar el c√≥digo actual. El tiempo de compilaci√≥n y ejecuci√≥n se muestra en la esquina inferior derecha. Cambie al tab "LLVM IR" para inspeccionar el c√≥digo intermedio generado.
            </div>
        </div>
    </div>

    <!-- EDITOR PANEL -->
    <div class="editor-panel">
        <div class="panel-label">
            <span class="dot"></span> main.hulk
        </div>
        <div id="editor"></div>
    </div>

    <div class="output-panel">
        <div class="output-tabs">
            <button class="tab-btn active" data-tab="output">Salida</button>
            <button class="tab-btn" data-tab="llvm">LLVM IR</button>
        </div>
        <div id="output-body" class="output-body">
            <div class="welcome-msg">
                <span class="big-icon">üíö</span>
                <div>Presiona <strong>‚ñ∂ Ejecutar</strong> o <strong>‚åò Enter</strong></div>
                <div>para compilar y ejecutar tu c√≥digo HULK</div>
            </div>
        </div>
        <div id="llvm-body" class="output-body hidden"></div>
    </div>
</main>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATUS BAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="status-bar">
    <div class="status-left">
        <span class="status-dot" id="status-dot"></span>
        <span id="status-text">Listo</span>
    </div>
    <div class="status-right">
        <span id="time-display"></span>
        <span>HULK v0.1.0</span>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MONACO EDITOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.min.js"></script>
<script>

// ‚îÄ‚îÄ Ejemplos de c√≥digo HULK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const EXAMPLES = {

hello: `// ¬°Tu primer programa en HULK!
{
    print("¬°Hola Mundo!");
    print("Bienvenido a HULK üíö");
}
`,

math: `// Variables con let-in y operadores matem√°ticos
{
    let pi = 3.14159 in
    let r = 5 in
    let area = pi * r ** 2 in {
        print("Radio:" @@ r);
        print("√Årea del c√≠rculo:" @@ area);
        print("Per√≠metro:" @@ (2 * pi * r));
    };
}
`,

functions: `// Funciones recursivas con =>
function factorial(n: Number): Number =>
    if (n <= 1) 1
    else n * factorial(n - 1);

function fibonacci(n: Number): Number =>
    if (n <= 1) n
    else fibonacci(n - 1) + fibonacci(n - 2);

{
    print("factorial(5) =" @@ factorial(5));
    print("factorial(10) =" @@ factorial(10));
    print("fibonacci(10) =" @@ fibonacci(10));
    print("fibonacci(15) =" @@ fibonacci(15));
}
`,

strings: `// @ concatena cadenas, @@ concatena con espacio
{
    let nombre = "HULK" in
    let version = "1.0" in {
        print("Lenguaje: " @ nombre @ " v" @ version);
        print("Hola" @@ "Mundo");
        print("2 + 3 =" @@ (2 + 3));
        print("PI =" @@ 3.14159);
    };
}
`,

conditionals: `// if / elif / else como expresiones
function clasificar(n: Number): String =>
    if (n > 0) "positivo"
    elif (n < 0) "negativo"
    else "cero";

function abs(x: Number): Number =>
    if (x < 0) (0 - x) else x;

function max(a: Number, b: Number): Number =>
    if (a >= b) a else b;

{
    print("5 es" @@ clasificar(5));
    print("-3 es" @@ clasificar(-3));
    print("0 es" @@ clasificar(0));
    print("|‚àí42| =" @@ abs(0 - 42));
    print("max(7, 12) =" @@ max(7, 12));
}
`,

loops: `// While loop con variables mutables
{
    let i = 0 in
    let sum = 0 in {
        while (i < 10) {
            i := i + 1;
            sum := sum + i;
        };
        print("Suma de 1 a 10 =" @@ sum);
    };

    // Conteo con condici√≥n
    let n = 1 in
    let pares = 0 in {
        while (n <= 20) {
            if (n % 2 == 0) pares := pares + 1
            else 0;
            n := n + 1;
        };
        print("Pares en [1,20]:" @@ pares);
    };
}
`,

types: `// Sistema de tipos con herencia
type Animal(name: String, sound: String) {
    name: String = name;
    sound: String = sound;
    speak(): String => self.name @ " dice: " @ self.sound;
}

type Dog(name: String) inherits Animal(name, "Guau!") {
    fetch(): String => self.name @ " busca la pelota!";
}

type Cat(name: String) inherits Animal(name, "Miau!") {
    purr(): String => self.name @ " ronronea...";
}

let rex = new Dog("Rex") in
let luna = new Cat("Luna") in {
    print(rex.speak());
    print(rex.fetch());
    print(luna.speak());
    print(luna.purr());
}
`,

iterables: `// Protocolo Iterable con tipo Range
type Range(min: Number, max: Number) {
    min: Number = min;
    max: Number = max;
    current: Number = min - 1;
    next(): Boolean => {
        self.current := self.current + 1;
        self.current < self.max;
    };
    get_current(): Number => self.current;
}

function range(min: Number, max: Number): Range =>
    new Range(min, max);

// For loop ‚Äî se transpila a while(iter.next())
{
    print("Contando del 1 al 5:");
    for (x in range(1, 6))
        print("  ‚Üí" @@ x);

    // Sumatoria con while
    let sum = 0 in
    let r = range(1, 101) in {
        while (r.next())
            let n = r.get_current() in
                sum := sum + n;
        print("Suma 1..100 =" @@ sum);
    };
}
`,

demo: `// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HULK Demo Completo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚Äî Funciones matem√°ticas ‚Äî
function abs(x: Number): Number =>
    if (x < 0) (0 - x) else x;

function factorial(n: Number): Number =>
    if (n <= 1) 1
    else n * factorial(n - 1);

function max(a: Number, b: Number): Number =>
    if (a >= b) a else b;

// ‚Äî Tipos con herencia ‚Äî
type Shape(name: String) {
    name: String = name;
    describe(): String => "Forma: " @ self.name;
}

type Circle(radius: Number) inherits Shape("Circulo") {
    radius: Number = radius;
    area(): Number => 3.14159 * self.radius ** 2;
}

type Square(side: Number) inherits Shape("Cuadrado") {
    side: Number = side;
    area(): Number => self.side ** 2;
}

// ‚Äî Iterable ‚Äî
type Range(min: Number, max: Number) {
    min: Number = min;
    max: Number = max;
    current: Number = min - 1;
    next(): Boolean => {
        self.current := self.current + 1;
        self.current < self.max;
    };
    get_current(): Number => self.current;
}

function range(min: Number, max: Number): Range =>
    new Range(min, max);

// ‚ïê‚ïê‚ïê Ejecuci√≥n ‚ïê‚ïê‚ïê
{
    print("=== HULK Demo ===");
    print("factorial(7) =" @@ factorial(7));
    print("|‚àí42| =" @@ abs(0 - 42));
    print("max(99, 42) =" @@ max(99, 42));

    let c = new Circle(5) in {
        print(c.describe());
        print("  Radio:" @@ c.radius);
        print("  Area:" @@ c.area());
    };

    let s = new Square(4) in {
        print(s.describe());
        print("  Lado:" @@ s.side);
        print("  Area:" @@ s.area());
    };

    print("Primeros 5 cuadrados:");
    for (n in range(1, 6))
        print("  " @@ n @ "^2 =" @@ (n ** 2));

    print("=== FIN ===");
}
`
};

// ‚îÄ‚îÄ Monaco setup ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

require.config({
    paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' }
});

require(['vs/editor/editor.main'], function () {

    // ‚îÄ‚îÄ Registrar lenguaje HULK ‚îÄ‚îÄ

    monaco.languages.register({ id: 'hulk' });

    monaco.languages.setMonarchTokensProvider('hulk', {
        keywords: [
            'let', 'in', 'if', 'elif', 'else', 'while', 'for',
            'function', 'type', 'inherits', 'protocol', 'extends',
            'new', 'print', 'true', 'false', 'self', 'is', 'as', 'not'
        ],
        typeKeywords: ['Number', 'String', 'Boolean', 'Object'],
        operators: [':=', '=>', '@@', '@', '**', '>=', '<=', '!=', '=='],

        tokenizer: {
            root: [
                [/\/\/.*$/, 'comment'],
                [/"[^"]*"/, 'string'],
                [/\d+(\.\d+)?([eE][+-]?\d+)?/, 'number'],
                [/[a-zA-Z_]\w*/, {
                    cases: {
                        '@keywords': 'keyword',
                        '@typeKeywords': 'type.identifier',
                        '@default': 'identifier'
                    }
                }],
                [/:=|=>|@@|@|\*\*/, 'operator'],
                [/[+\-*/%]/, 'operator'],
                [/[><=!]=?/, 'operator'],
                [/[&|]/, 'operator'],
                [/[{}()\[\]]/, '@brackets'],
                [/[;,.:]+/, 'delimiter'],
                [/\s+/, 'white'],
            ]
        }
    });

    // Auto-completado b√°sico
    monaco.languages.registerCompletionItemProvider('hulk', {
        provideCompletionItems: function (model, position) {
            const word = model.getWordUntilPosition(position);
            const range = {
                startLineNumber: position.lineNumber,
                endLineNumber: position.lineNumber,
                startColumn: word.startColumn,
                endColumn: word.endColumn
            };
            const kw = (label, insert) => ({
                label, kind: monaco.languages.CompletionItemKind.Keyword,
                insertText: insert || label, range,
                insertTextRules: insert ? monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet : 0
            });
            return {
                suggestions: [
                    kw('print', 'print($1);'),
                    kw('let', 'let ${1:x} = ${2:value} in\n    $0'),
                    kw('function', 'function ${1:name}(${2:args}): ${3:Type} =>\n    $0;'),
                    kw('type', 'type ${1:Name}(${2:args}) {\n    $0\n}'),
                    kw('inherits', 'inherits ${1:Parent}($2)'),
                    kw('if', 'if ($1) $2\nelse $0'),
                    kw('while', 'while ($1) {\n    $0\n};'),
                    kw('for', 'for (${1:x} in ${2:iterable})\n    $0;'),
                    kw('self'),
                    kw('new', 'new ${1:Type}($2)'),
                    kw('true'), kw('false'),
                    kw('Number'), kw('String'), kw('Boolean'),
                ]
            };
        }
    });

    // ‚îÄ‚îÄ Theme personalizado ‚îÄ‚îÄ

    monaco.editor.defineTheme('hulk-dark', {
        base: 'vs-dark',
        inherit: true,
        rules: [
            { token: 'keyword',         foreground: '4ade80', fontStyle: 'bold' },
            { token: 'type.identifier',  foreground: 'a78bfa' },
            { token: 'string',          foreground: 'fbbf24' },
            { token: 'number',          foreground: 'fb923c' },
            { token: 'comment',         foreground: '6b7280', fontStyle: 'italic' },
            { token: 'operator',        foreground: '67e8f9' },
            { token: 'delimiter',       foreground: '636e7b' },
            { token: 'identifier',      foreground: 'e2e8f0' },
            { token: '@brackets',       foreground: 'cbd5e1' },
        ],
        colors: {
            'editor.background':               '#0d1117',
            'editor.foreground':               '#e2e8f0',
            'editorLineNumber.foreground':     '#3b4557',
            'editorLineNumber.activeForeground': '#8b949e',
            'editorCursor.foreground':         '#4ade80',
            'editor.selectionBackground':      '#264f7860',
            'editor.lineHighlightBackground':  '#161b2266',
            'editorIndentGuide.background1':    '#1e293b',
            'editorWidget.background':         '#161b22',
            'editorWidget.border':             '#2a3444',
            'editorSuggestWidget.background':  '#161b22',
            'editorSuggestWidget.border':      '#2a3444',
            'editorSuggestWidget.selectedBackground': '#264f7840',
        }
    });

    // ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ

    const outputBody  = document.getElementById('output-body');
    const llvmBody    = document.getElementById('llvm-body');
    const statusDot   = document.getElementById('status-dot');
    const statusText  = document.getElementById('status-text');
    const timeDisplay = document.getElementById('time-display');
    let editor; // Declarar editor aqu√≠ para que est√© accesible

    // ‚îÄ‚îÄ Ejecutar c√≥digo ‚îÄ‚îÄ

    window.runCode = async function() {
        const btn = document.getElementById('run-btn');
        if (!btn) return;
        if (!editor) return;

        // Estado: compilando
        btn.classList.add('loading');
        statusDot.className = 'status-dot busy';
        statusText.textContent = 'Compilando‚Ä¶';
        timeDisplay.textContent = '';
        outputBody.innerHTML = '<span style="color:var(--text-3)">‚è≥ Compilando y ejecutando‚Ä¶</span>';
        llvmBody.textContent = '';

        // Cambiar a tab salida
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelector('[data-tab="output"]').classList.add('active');
        outputBody.classList.remove('hidden');
        llvmBody.classList.add('hidden');

        try {
            const resp = await fetch('/api/run', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: editor.getValue() })
            });

            const data = await resp.json();

            if (data.success) {
                statusDot.className = 'status-dot';
                statusText.textContent = 'Ejecuci√≥n exitosa';
                outputBody.innerHTML = '<span class="out-ok">' + esc(data.output) + '</span>';
            } else {
                statusDot.className = 'status-dot err';
                statusText.textContent = 'Error';
                let html = '';
                if (data.output) html += esc(data.output);
                if (data.errors) html += '<span class="out-err">' + esc(data.errors) + '</span>';
                outputBody.innerHTML = html || '<span class="out-err">Error desconocido</span>';
            }

            if (data.llvm_ir) llvmBody.textContent = data.llvm_ir;
            timeDisplay.textContent = data.time_ms + 'ms';

        } catch (err) {
            statusDot.className = 'status-dot err';
            statusText.textContent = 'Error de conexi√≥n';
            outputBody.innerHTML = '<span class="out-err">‚ùå No se pudo conectar al servidor.\nAseg√∫rate de que el playground est√° corriendo:\n\n  cargo run --bin hulk-playground</span>';
        }

        btn.classList.remove('loading');
    }

    // ‚îÄ‚îÄ Crear editor ‚îÄ‚îÄ

    editor = monaco.editor.create(document.getElementById('editor'), {
        value: EXAMPLES.hello,
        language: 'hulk',
        theme: 'hulk-dark',
        fontSize: 14,
        fontFamily: "'JetBrains Mono', 'Fira Code', monospace",
        fontLigatures: true,
        minimap: { enabled: false },
        padding: { top: 16, bottom: 16 },
        scrollBeyondLastLine: false,
        renderLineHighlight: 'all',
        smoothScrolling: true,
        cursorBlinking: 'smooth',
        cursorSmoothCaretAnimation: 'on',
        bracketPairColorization: { enabled: true },
        automaticLayout: true,
        suggest: { showKeywords: true },
        tabSize: 4,
        wordWrap: 'on',
    });

    // ‚îÄ‚îÄ Atajo de teclado: Cmd+Enter ‚îÄ‚îÄ
    editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, () => window.runCode());

    // ‚îÄ‚îÄ Helper function ‚îÄ‚îÄ
    function esc(text) {
        const d = document.createElement('div');
        d.textContent = text;
        return d.innerHTML;
    }

    // ‚îÄ‚îÄ Selector de ejemplos ‚îÄ‚îÄ

    document.getElementById('examples').addEventListener('change', function (e) {
        const key = e.target.value;
        if (key && EXAMPLES[key]) {
            editor.setValue(EXAMPLES[key]);
            // Reset output
            outputBody.innerHTML = '<div class="welcome-msg"><span class="big-icon">üíö</span><div>C√≥digo cargado ‚Äî presiona <strong>‚ñ∂ Ejecutar</strong></div></div>';
            llvmBody.textContent = '';
            statusDot.className = 'status-dot';
            statusText.textContent = 'Listo';
            timeDisplay.textContent = '';
        }
        e.target.selectedIndex = 0;
    });

    // ‚îÄ‚îÄ Bot√≥n ejecutar ‚îÄ‚îÄ
    document.getElementById('run-btn').addEventListener('click', () => window.runCode());

    // ‚îÄ‚îÄ View Toggle (Editor ‚Üî Docs) ‚îÄ‚îÄ
    
    const sidebar = document.getElementById('sidebar');
    const editorPanel = document.querySelector('.editor-panel');
    const outputPanel = document.querySelector('.output-panel');
    const viewToggle = document.getElementById('view-toggle');
    let docsMode = false;

    viewToggle.addEventListener('click', () => {
        docsMode = !docsMode;
        
        if (docsMode) {
            sidebar.classList.add('expanded');
            editorPanel.classList.add('hidden');
            outputPanel.classList.add('hidden');
            viewToggle.classList.add('active');
            viewToggle.querySelector('.label').textContent = 'Editor';
            viewToggle.querySelector('.icon').textContent = '‚å®Ô∏è';
            viewToggle.title = 'Volver al editor';
        } else {
            sidebar.classList.remove('expanded');
            editorPanel.classList.remove('hidden');
            outputPanel.classList.remove('hidden');
            viewToggle.classList.remove('active');
            viewToggle.querySelector('.label').textContent = 'Docs';
            viewToggle.querySelector('.icon').textContent = 'üìñ';
            viewToggle.title = 'Ver documentaci√≥n completa';
        }
    });

    // ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ

    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function () {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            const tab = this.dataset.tab;
            outputBody.classList.toggle('hidden', tab !== 'output');
            llvmBody.classList.toggle('hidden', tab !== 'llvm');
        });
    });
});
</script>
</body>
</html>
